const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dh4QyAf8.js","assets/index-BQt_v0Ij.css"])))=>i.map(i=>d[i]);
import{c as H,j as e,r as a,_ as V}from"./index-Dh4QyAf8.js";import{c as Q,B as O}from"./button-BzfyNrUA.js";import{I as G}from"./ImageWithFallback-ClDaaeji.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],X=H("search",K);function B({className:x,type:j,...p}){return e.jsx("input",{type:j,"data-slot":"input",className:Q("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",x),...p})}function Y({content:x,onChange:j,placeholder:p}){const i=a.useRef(null),[w,h]=a.useState(!1),[c,D]=a.useState({textType:"body",bold:!1,italic:!1,underline:!1,strikethrough:!1}),N=a.useCallback(()=>{if(!i.current)return;i.current.querySelectorAll("*").forEach(t=>{if(t.textContent&&t.textContent.includes("data:image/")){const r=t.textContent.match(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/);if(r){const o=document.createElement("img");o.src=r[0],o.style.maxWidth="100%",o.style.height="auto",o.style.display="block",o.style.margin="16px 0",o.alt="Image",t.textContent="",t.appendChild(o)}}}),i.current.querySelectorAll("img").forEach(t=>{t.style.maxWidth="100%",t.style.height="auto",t.style.display="block",t.style.margin="16px 0"})},[]);a.useEffect(()=>{i.current&&x!==i.current.innerHTML&&(i.current.innerHTML=x,setTimeout(()=>{N()},0))},[x,N]);const m=a.useCallback(()=>{if(!document.getSelection()?.rangeCount)return;const l=document.getSelection().getRangeAt(0),t=l.commonAncestorContainer.nodeType===Node.TEXT_NODE?l.commonAncestorContainer.parentElement:l.commonAncestorContainer;if(!t)return;let r="body";const o=t.tagName?.toLowerCase();o==="h1"?r="h1":o==="h2"?r="h2":o==="h3"&&(r="h3"),D({textType:r,bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikeThrough")})},[]),u=a.useCallback(()=>{i.current&&(N(),j(i.current.innerHTML),m())},[j,m,N]),f=a.useCallback(()=>{m()},[m]);a.useEffect(()=>(document.addEventListener("selectionchange",f),()=>document.removeEventListener("selectionchange",f)),[f]);const g=(n,l)=>{document.execCommand(n,!1,l),i.current?.focus(),u()},C=n=>{g("formatBlock",{body:"div",h1:"h1",h2:"h2",h3:"h3"}[n])},E=async n=>new Promise(l=>{const t=new FileReader;t.onload=r=>{const o=r.target?.result;l(o)},t.readAsDataURL(n)}),S=async n=>{const l=await E(n),t=document.createElement("div");t.style.margin="16px 0",t.style.display="block";const r=document.createElement("img");r.src=l,r.style.maxWidth="100%",r.style.height="auto",r.style.display="block",r.alt="Uploaded image",t.appendChild(r);const o=document.getSelection();if(o&&o.rangeCount>0){const k=o.getRangeAt(0);k.deleteContents(),k.insertNode(t),k.setStartAfter(t),k.collapse(!0),o.removeAllRanges(),o.addRange(k)}else i.current&&i.current.appendChild(t);u()},T=async n=>{const t=Array.from(n.clipboardData.items).filter(r=>r.type.startsWith("image/"));if(t.length>0){n.preventDefault();for(const r of t){const o=r.getAsFile();o&&await S(o)}return}setTimeout(()=>{N()},0)},A=async n=>{n.preventDefault(),h(!1);const t=Array.from(n.dataTransfer.files).filter(r=>r.type.startsWith("image/"));for(const r of t)await S(r)},U=n=>{n.preventDefault(),h(!0)},_=n=>{n.preventDefault(),h(!1)};return e.jsxs("div",{className:"border-2 border-border bg-card",children:[e.jsx("div",{className:"border-b-2 border-border p-4 bg-muted/20 font-[JetBrains_Mono]",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-[JetBrains_Mono] text-sm font-medium",children:"TYPE:"}),e.jsxs("div",{className:"flex border-2 border-border",children:[e.jsx("button",{onClick:()=>C("body"),className:`px-3 py-1 text-sm border-r-2 border-border transition-colors ${c.textType==="body"?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:"Body"}),e.jsx("button",{onClick:()=>C("h3"),className:`px-3 py-1 text-sm border-r-2 border-border transition-colors ${c.textType==="h3"?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:"H3"}),e.jsx("button",{onClick:()=>C("h2"),className:`px-3 py-1 text-sm border-r-2 border-border transition-colors ${c.textType==="h2"?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:"H2"}),e.jsx("button",{onClick:()=>C("h1"),className:`px-3 py-1 text-sm transition-colors ${c.textType==="h1"?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:"H1"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-[JetBrains_Mono] text-sm font-medium",children:"FORMAT:"}),e.jsxs("div",{className:"flex border-2 border-border",children:[e.jsx("button",{onClick:()=>g("bold"),className:`px-3 py-1 text-sm font-bold border-r-2 border-border transition-colors ${c.bold?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:"B"}),e.jsx("button",{onClick:()=>g("italic"),className:`px-3 py-1 text-sm italic border-r-2 border-border transition-colors ${c.italic?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:"I"}),e.jsx("button",{onClick:()=>g("underline"),className:`px-3 py-1 text-sm underline border-r-2 border-border transition-colors ${c.underline?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:"U"}),e.jsx("button",{onClick:()=>g("strikeThrough"),className:`px-3 py-1 text-sm line-through transition-colors ${c.strikethrough?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:"S"})]})]})]})}),e.jsxs("div",{className:`relative min-h-[400px] ${w?"bg-muted/50":""}`,onDrop:A,onDragOver:U,onDragLeave:_,children:[e.jsx("div",{ref:i,contentEditable:!0,onInput:u,onPaste:T,className:"p-4 min-h-[400px] outline-none rich-text-editor",suppressContentEditableWarning:!0,"data-placeholder":x?void 0:p||`Start typing your content...

Paste images with Ctrl+V or drag & drop images anywhere`}),w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/80 border-2 border-dashed border-primary",children:e.jsx("p",{className:"mono text-primary",children:"Drop images here"})}),e.jsx("div",{className:"px-4 pb-4 text-xs text-muted-foreground font-[JetBrains_Mono]",children:"Select text to apply formatting • Ctrl+V to paste images • Drag & drop images"})]})]})}function oe({onSave:x,onCancel:j,initialBlog:p}){const[i,w]=a.useState(p?.title||""),[h,c]=a.useState(p?.content||""),[D,N]=a.useState(p?.images||[]),[m,u]=a.useState(p?.coverImage||""),[f,g]=a.useState(""),[C,E]=a.useState(!1),[S,T]=a.useState(!1),A=a.useRef(null),[U,_]=a.useState(""),[n,l]=a.useState(!1),[t,r]=a.useState(!1),[o,k]=a.useState(!1);a.useRef(null);const P=(s,b=800,I=.8)=>new Promise((d,M)=>{const y=document.createElement("canvas"),W=y.getContext("2d"),v=new Image;v.onload=()=>{const L=Math.min(b/v.width,b/v.height);y.width=v.width*L,y.height=v.height*L,W?.drawImage(v,0,0,y.width,y.height);const z=y.toDataURL("image/jpeg",I);d(z)},v.onerror=M,v.src=URL.createObjectURL(s)}),R=()=>"#808080",[Z]=a.useState(()=>R()),F=async()=>{if(f.trim()){E(!0);try{const{projectId:s,publicAnonKey:b}=await V(async()=>{const{projectId:d,publicAnonKey:M}=await import("./index-Dh4QyAf8.js").then(y=>y.i);return{projectId:d,publicAnonKey:M}},__vite__mapDeps([0,1])),I=await fetch(`https://${s}.supabase.co/functions/v1/make-server-538d7667/unsplash`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({query:f})});if(I.ok){const{imageUrl:d}=await I.json();u(d),g("")}else{const d=`https://picsum.photos/800/400?random=${Date.now()}`;u(d),g("")}}catch(s){console.error("Error adding cover image:",s);const b=`https://picsum.photos/800/400?random=${Date.now()}`;u(b),g("")}finally{E(!1)}}},J=async s=>{if(!s||s.length===0)return;const b=s[0],I=5*1024*1024;if(!b.type.startsWith("image/")){alert("Please select an image file.");return}if(b.size>I){alert("File is too large. Maximum file size is 5MB.");return}T(!0);try{const d=await P(b,800,.8);u(d)}catch(d){console.error("Error processing cover image:",d),alert("Error processing image. Please try again.")}finally{T(!1)}},$=()=>{A.current?.click()},q=()=>{if(!i.trim()||!h.trim())return;const s=m||R();x({title:i,content:h,images:D,coverImage:s})};return e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 border-b border-border pb-4",children:[e.jsx("h2",{className:"font-[JetBrains_Mono] text-[20px] font-bold",children:p?"EDIT POST":"NEW POST"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(O,{variant:"outline",onClick:j,className:"border-2 border-border bg-transparent hover:bg-muted font-[JetBrains_Mono] text-[14px]",children:"CANCEL"}),e.jsx(O,{onClick:q,disabled:!i.trim()||!h.trim(),className:"border-2 border-primary bg-primary hover:bg-accent font-[JetBrains_Mono]",children:"SAVE"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(B,{value:i,onChange:s=>w(s.target.value),placeholder:"Post title...",className:"border-2 border-border bg-input-background p-4 text-xl font-medium"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-4 font-bold text-foreground text-[20px] tracking-[0.3px] border-b-2 border-border pb-2 font-[JetBrains_Mono]",children:"COVER IMAGE"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Upload an image, add a URL, or search for stock images. If left empty, a grey solid color will be used."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 items-stretch",children:[e.jsx("button",{type:"button",onClick:$,disabled:S,className:"bg-background border-2 border-border border-solid px-4 py-3 font-bold text-foreground text-[14px] tracking-[0.2px] hover:bg-muted transition-colors disabled:opacity-50 text-center font-[JetBrains_Mono]",children:S?"UPLOADING...":"UPLOAD IMAGE"}),e.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:s=>J(s.target.files),className:"hidden"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{value:f,onChange:s=>g(s.target.value),placeholder:"Search stock images...",className:"flex-1 bg-background border-2 border-border border-solid px-3 py-3 font-normal text-foreground text-[14px] tracking-[-0.1px] placeholder:text-muted-foreground font-[JetBrains_Mono]"}),e.jsx("button",{onClick:F,disabled:!f.trim()||C,className:"bg-background border-2 border-border border-l-0 border-solid px-4 py-3 font-bold text-foreground text-[14px] tracking-[0.2px] hover:bg-muted transition-colors disabled:opacity-50",children:C?"...":e.jsx(X,{size:16})})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(B,{value:m,onChange:s=>u(s.target.value),placeholder:"Or paste image URL...",className:"border-2 border-border bg-input-background p-3 text-[14px] font-[JetBrains_Mono]"})})]}),m&&e.jsxs("div",{className:"relative mb-4",children:[e.jsx(G,{src:m,alt:"Cover image preview",className:"w-full h-48 object-cover border-2 border-border"}),e.jsx("button",{onClick:()=>u(""),className:"absolute top-2 right-2 bg-muted-foreground border-2 border-border border-solid w-8 h-8 font-bold text-background text-[12px] hover:bg-border hover:text-foreground transition-colors",children:"✕"})]}),!m&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"w-full h-48 border-2 border-border flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:"var(--secondary)"}})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-4 font-bold text-foreground text-[20px] tracking-[0.3px] border-b-2 border-border pb-2 font-[JetBrains_Mono]",children:"CONTENT"}),e.jsx(Y,{content:h,onChange:c})]})]})}export{oe as BlogEditor};
